import{h as de,v as ce,p as C,Q as z}from"./format-CFJWS_CJ.js";import{Q as O,a as j,b as A,c as I}from"./QTable-CFp7zhAH.js";import{a as me,g as fe,c as ve,Q as H,b as J,d as v,e as W,f as L,h as X,p as Y,i as Z}from"./axios2-WT2n_XLk.js";import{g as pe,r as y,P as be,Q as ge,G as ie,j as _e,i as ye,E as ee,H as Ve,I as Ce,R as xe,q as Ue,S as we,_ as Pe,h as oe,c as Ee,b as s,N as o,L as t,o as R,O as w,T as Q,f as $,w as ae,K as te}from"./index-C6qVUNaC.js";import{S as _}from"./sweetalert2.esm.all-B0Dix5B2.js";import"./QList-Bie9ySOy.js";import"./index-DW_MHI2K.js";const le=pe({name:"QForm",props:{autofocus:Boolean,noErrorFocus:Boolean,noResetFocus:Boolean,greedy:Boolean,onSubmit:Function},emits:["reset","validationSuccess","validationError"],setup(i,{slots:m,emit:f}){const p=_e(),c=y(null);let V=0;const b=[];function k(r){const U=typeof r=="boolean"?r:i.noErrorFocus!==!0,N=++V,T=(d,g)=>{f(`validation${d===!0?"Success":"Error"}`,g)},E=d=>{const g=d.validate();return typeof g.then=="function"?g.then(x=>({valid:x,comp:d}),x=>({valid:!1,comp:d,err:x})):Promise.resolve({valid:g,comp:d})};return(i.greedy===!0?Promise.all(b.map(E)).then(d=>d.filter(g=>g.valid!==!0)):b.reduce((d,g)=>d.then(()=>E(g).then(x=>{if(x.valid===!1)return Promise.reject(x)})),Promise.resolve()).catch(d=>[d])).then(d=>{if(d===void 0||d.length===0)return N===V&&T(!0),!0;if(N===V){const{comp:g,err:x}=d[0];if(x!==void 0&&console.error(x),T(!1,g),U===!0){const D=d.find(({comp:q})=>typeof q.focus=="function"&&ce(q.$)===!1);D!==void 0&&D.comp.focus()}}return!1})}function S(){V++,b.forEach(r=>{typeof r.resetValidation=="function"&&r.resetValidation()})}function B(r){r!==void 0&&ee(r);const U=V+1;k().then(N=>{U===V&&N===!0&&(i.onSubmit!==void 0?f("submit",r):r!==void 0&&r.target!==void 0&&typeof r.target.submit=="function"&&r.target.submit())})}function h(r){r!==void 0&&ee(r),f("reset"),Ve(()=>{S(),i.autofocus===!0&&i.noResetFocus!==!0&&n()})}function n(){me(()=>{if(c.value===null)return;const r=c.value.querySelector("[autofocus][tabindex], [data-autofocus][tabindex]")||c.value.querySelector("[autofocus] [tabindex], [data-autofocus] [tabindex]")||c.value.querySelector("[autofocus], [data-autofocus]")||Array.prototype.find.call(c.value.querySelectorAll("[tabindex]"),U=>U.tabIndex!==-1);r!=null&&r.focus({preventScroll:!0})})}Ce(xe,{bindComponent(r){b.push(r)},unbindComponent(r){const U=b.indexOf(r);U!==-1&&b.splice(U,1)}});let u=!1;return be(()=>{u=!0}),ge(()=>{u===!0&&i.autofocus===!0&&n()}),ie(()=>{i.autofocus===!0&&n()}),Object.assign(p.proxy,{validate:k,resetValidation:S,submit:B,reset:h,focus:n,getValidationComponents:()=>b}),()=>ye("form",{class:"q-form",ref:c,onSubmit:B,onReset:h},de(m.default))}});function re(i){if(i===!1)return 0;if(i===!0||i===void 0)return 1;const m=parseInt(i,10);return isNaN(m)?0:m}const M=Ue({name:"close-popup",beforeMount(i,{value:m}){const f={depth:re(m),handler(p){f.depth!==0&&setTimeout(()=>{const c=fe(i);c!==void 0&&ve(c,p,f.depth)})},handlerKey(p){we(p,13)===!0&&f.handler(p)}};i.__qclosepopup=f,i.addEventListener("click",f.handler),i.addEventListener("keyup",f.handlerKey)},updated(i,{value:m,oldValue:f}){m!==f&&(i.__qclosepopup.depth=re(m))},beforeUnmount(i){const m=i.__qclosepopup;i.removeEventListener("click",m.handler),i.removeEventListener("keyup",m.handlerKey),delete i.__qclosepopup}}),Be={class:"q-pa-md container"},he={class:"section-title"},qe={class:"table-card"},ke={class:"table-header"},Se={class:"text-center q-my-md text-grey"},Ne={class:"text-h6"},ze={class:"form-grid"},Qe={class:"form-actions"},Te={class:"section-title"},De={class:"table-card"},Fe={class:"table-header"},Ae={class:"text-center q-my-md text-grey"},Ie={class:"text-h6"},Le={class:"form-grid"},$e={class:"form-actions"},Me={__name:"UsuariosyProductos",setup(i){const m=y([]),f=y([]),p=y(!1),c=y(!1),V=y(!1),b=y(!1),k=y(null),S=y(null),B=y(""),h=y(""),n=y({identification:"",dv:"",company:"",trade_name:"",names:"",address:"",email:"",phone:"",legal_organization_id:"1",tribute_id:"1",identification_document_id:"1",municipality_id:"1"}),u=y({code_reference:"",name:"",quantity:1,discount_rate:0,price:0,tax_rate:0,unit_measure_id:1,standard_code_id:1,is_excluded:0,tribute_id:1}),r=[{name:"identification",label:"Identificación",field:"identification",align:"left"},{name:"dv",label:"DV",field:"dv",align:"left"},{name:"company",label:"Compañía",field:"company",align:"left"},{name:"trade_name",label:"Nombre Comercial",field:"trade_name",align:"left"},{name:"acciones",label:"Acciones",field:"acciones",align:"center"}],U=[{name:"code_reference",label:"Código de Referencia",field:"code_reference",align:"left"},{name:"name",label:"Nombre",field:"name",align:"left"},{name:"quantity",label:"Cantidad",field:"quantity",align:"left"},{name:"price",label:"Precio",field:"price",align:"right",format:l=>`$${l.toFixed(2)}`},{name:"acciones",label:"Acciones",field:"acciones",align:"center"}],N=oe(()=>{if(!B.value)return m.value;const l=B.value.toLowerCase();return m.value.filter(e=>{var a,P,G;return((a=e.identification)==null?void 0:a.toString().toLowerCase().includes(l))||((P=e.company)==null?void 0:P.toLowerCase().includes(l))||((G=e.trade_name)==null?void 0:G.toLowerCase().includes(l))})}),T=oe(()=>{if(!h.value)return f.value;const l=h.value.toLowerCase();return f.value.filter(e=>{var a,P;return((a=e.code_reference)==null?void 0:a.toString().toLowerCase().includes(l))||((P=e.name)==null?void 0:P.toLowerCase().includes(l))})}),E=async()=>{try{const l=await J("/usuarios/users");m.value=l;const e=await J("/productos");f.value=e}catch(l){console.error("Error al traer los datos",l),_.fire("Error","No se pudieron cargar los datos","error")}},K=()=>{p.value=!p.value,p.value||q()},d=()=>{c.value=!c.value,c.value||F()},g=async()=>{try{V.value?(await Y(`/usuarios/${k.value}`,n.value),_.fire({icon:"success",title:"Actualizado",text:"Usuario actualizado correctamente",showConfirmButton:!1,timer:1500})):(await Z("/usuarios",n.value),_.fire({icon:"success",title:"Éxito",text:"Usuario creado correctamente",showConfirmButton:!1,timer:1500})),E(),q(),p.value=!1}catch(l){console.error("Error al guardar usuario:",l),_.fire("Error","No se pudo guardar el usuario","error")}},x=l=>{V.value=!0,k.value=l._id,n.value={...l},p.value=!0},D=async l=>{if((await _.fire({title:"¿Estás seguro?",text:"Esta acción eliminará al usuario",icon:"warning",showCancelButton:!0,confirmButtonText:"Sí, eliminar",cancelButtonText:"Cancelar",confirmButtonColor:"#d33",cancelButtonColor:"#3085d6"})).isConfirmed)try{await X(`/usuarios/${l._id}`),_.fire({icon:"success",title:"Eliminado",text:"Usuario eliminado correctamente",showConfirmButton:!1,timer:1500}),E()}catch(a){console.error("Error al eliminar usuario:",a),_.fire("Error","No se pudo eliminar el usuario","error")}},q=()=>{n.value={identification:"",dv:"",company:"",trade_name:"",names:"",address:"",email:"",phone:"",legal_organization_id:"1",tribute_id:"1",identification_document_id:"1",municipality_id:"1"},V.value=!1,k.value=null},ne=async()=>{try{b.value?(await Y(`/productos/${S.value}`,u.value),_.fire({icon:"success",title:"Actualizado",text:"Producto actualizado correctamente",showConfirmButton:!1,timer:1500})):(await Z("/productos/items",u.value),_.fire({icon:"success",title:"Éxito",text:"Producto creado correctamente",showConfirmButton:!1,timer:1500})),E(),F(),c.value=!1}catch(l){console.error("Error al guardar producto:",l),_.fire("Error","No se pudo guardar el producto","error")}},se=l=>{b.value=!0,S.value=l._id,u.value={...l},c.value=!0},ue=async l=>{if((await _.fire({title:"¿Estás seguro?",text:"Esta acción eliminará el producto",icon:"warning",showCancelButton:!0,confirmButtonText:"Sí, eliminar",cancelButtonText:"Cancelar",confirmButtonColor:"#d33",cancelButtonColor:"#3085d6"})).isConfirmed)try{await X(`/productos/${l._id}`),_.fire({icon:"success",title:"Eliminado",text:"Producto eliminado correctamente",showConfirmButton:!1,timer:1500}),E()}catch(a){console.error("Error al eliminar producto:",a),_.fire("Error","No se pudo eliminar el producto","error")}},F=()=>{u.value={code_reference:"",name:"",quantity:1,discount_rate:0,price:0,tax_rate:0,unit_measure_id:1,standard_code_id:1,is_excluded:0,tribute_id:1},b.value=!1,S.value=null};return ie(()=>{E()}),(l,e)=>(R(),Ee("div",Be,[s("div",he,[e[18]||(e[18]=s("h2",null,"Gestión de Usuarios",-1)),o(C,{class:"add-btn",color:"blue",onClick:K},{default:t(()=>[o(z,{name:"person_add",class:"q-mr-sm"}),w(" "+Q(p.value?"Ocultar Formulario":"Agregar Usuario"),1)]),_:1})]),s("div",qe,[o(O,{title:"Usuarios",rows:N.value,columns:r,"row-key":"identification",class:"custom-table",pagination:{rowsPerPage:10}},{top:t(()=>[s("div",ke,[e[19]||(e[19]=s("div",{class:"text-h6"},"Usuarios",-1)),o(I),o(v,{dense:"",outlined:"",modelValue:B.value,"onUpdate:modelValue":e[0]||(e[0]=a=>B.value=a),placeholder:"Buscar usuario...",class:"search-input",clearable:""},{append:t(()=>[o(z,{name:"search"})]),_:1},8,["modelValue"])])]),"body-cell-acciones":t(a=>[o(j,{props:a,class:"text-center"},{default:t(()=>[o(C,{size:"sm",color:"blue",onClick:P=>x(a.row),icon:"edit",class:"action-btn",flat:""},{default:t(()=>[o(A,null,{default:t(()=>e[20]||(e[20]=[w("Editar usuario")])),_:1})]),_:2},1032,["onClick"]),o(C,{size:"sm",color:"red",onClick:P=>D(a.row),icon:"delete",class:"action-btn",flat:""},{default:t(()=>[o(A,null,{default:t(()=>e[21]||(e[21]=[w("Eliminar usuario")])),_:1})]),_:2},1032,["onClick"])]),_:2},1032,["props"])]),"no-data":t(()=>[s("div",Se,[o(z,{name:"people",size:"lg"}),e[22]||(e[22]=s("div",null,"No hay usuarios registrados aún.",-1))])]),_:1},8,["rows"])]),o(H,{modelValue:p.value,"onUpdate:modelValue":e[9]||(e[9]=a=>p.value=a),persistent:"",maximized:""},{default:t(()=>[o(W,{class:"dialog-card"},{default:t(()=>[o(L,{class:"dialog-header"},{default:t(()=>[s("div",Ne,Q(V.value?"Editar Usuario":"Crear Usuario"),1),o(I),$(o(C,{icon:"close",flat:"",round:"",dense:"",onClick:q},null,512),[[M]])]),_:1}),o(L,{class:"q-pa-lg"},{default:t(()=>[o(le,{onSubmit:ae(g,["prevent"]),class:"form-container"},{default:t(()=>[s("div",ze,[o(v,{modelValue:n.value.identification,"onUpdate:modelValue":e[1]||(e[1]=a=>n.value.identification=a),label:"Identificación",outlined:"",class:"form-field"},null,8,["modelValue"]),o(v,{modelValue:n.value.dv,"onUpdate:modelValue":e[2]||(e[2]=a=>n.value.dv=a),label:"DV",outlined:"",class:"form-field"},null,8,["modelValue"]),o(v,{modelValue:n.value.company,"onUpdate:modelValue":e[3]||(e[3]=a=>n.value.company=a),label:"Compañía",outlined:"",class:"form-field"},null,8,["modelValue"]),o(v,{modelValue:n.value.trade_name,"onUpdate:modelValue":e[4]||(e[4]=a=>n.value.trade_name=a),label:"Nombre Comercial",outlined:"",class:"form-field"},null,8,["modelValue"]),o(v,{modelValue:n.value.names,"onUpdate:modelValue":e[5]||(e[5]=a=>n.value.names=a),label:"Nombres",outlined:"",class:"form-field"},null,8,["modelValue"]),o(v,{modelValue:n.value.address,"onUpdate:modelValue":e[6]||(e[6]=a=>n.value.address=a),label:"Dirección",outlined:"",class:"form-field"},null,8,["modelValue"]),o(v,{modelValue:n.value.email,"onUpdate:modelValue":e[7]||(e[7]=a=>n.value.email=a),label:"Email",outlined:"",type:"email",class:"form-field"},null,8,["modelValue"]),o(v,{modelValue:n.value.phone,"onUpdate:modelValue":e[8]||(e[8]=a=>n.value.phone=a),label:"Teléfono",outlined:"",class:"form-field"},null,8,["modelValue"])]),s("div",Qe,[$((R(),te(C,{type:"button",color:"grey",class:"q-mr-md",onClick:q},{default:t(()=>e[23]||(e[23]=[w(" Cancelar ")])),_:1})),[[M]]),o(C,{type:"submit",color:"green"},{default:t(()=>[w(Q(V.value?"Actualizar Usuario":"Guardar Usuario"),1)]),_:1})])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),e[30]||(e[30]=s("div",{class:"section-divider"},null,-1)),s("div",Te,[e[24]||(e[24]=s("h2",null,"Gestión de Productos",-1)),o(C,{class:"add-btn",color:"green",onClick:d},{default:t(()=>[o(z,{name:"add_shopping_cart",class:"q-mr-sm"}),w(" "+Q(c.value?"Ocultar Formulario":"Agregar Producto"),1)]),_:1})]),s("div",De,[o(O,{class:"custom-table",title:"Productos",rows:T.value,columns:U,"row-key":"code_reference",pagination:{rowsPerPage:10}},{top:t(()=>[s("div",Fe,[e[25]||(e[25]=s("div",{class:"text-h6"},"Productos",-1)),o(I),o(v,{dense:"",outlined:"",modelValue:h.value,"onUpdate:modelValue":e[10]||(e[10]=a=>h.value=a),placeholder:"Buscar producto...",class:"search-input",clearable:""},{append:t(()=>[o(z,{name:"search"})]),_:1},8,["modelValue"])])]),"body-cell-acciones":t(a=>[o(j,{props:a,class:"text-center"},{default:t(()=>[o(C,{size:"sm",color:"blue",onClick:P=>se(a.row),icon:"edit",class:"action-btn",flat:""},{default:t(()=>[o(A,null,{default:t(()=>e[26]||(e[26]=[w("Editar producto")])),_:1})]),_:2},1032,["onClick"]),o(C,{size:"sm",color:"red",onClick:P=>ue(a.row),icon:"delete",class:"action-btn",flat:""},{default:t(()=>[o(A,null,{default:t(()=>e[27]||(e[27]=[w("Eliminar producto")])),_:1})]),_:2},1032,["onClick"])]),_:2},1032,["props"])]),"no-data":t(()=>[s("div",Ae,[o(z,{name:"shopping_cart",size:"lg"}),e[28]||(e[28]=s("div",null,"No hay productos registrados aún.",-1))])]),_:1},8,["rows"])]),o(H,{modelValue:c.value,"onUpdate:modelValue":e[17]||(e[17]=a=>c.value=a),persistent:"",maximized:""},{default:t(()=>[o(W,{class:"dialog-card"},{default:t(()=>[o(L,{class:"dialog-header"},{default:t(()=>[s("div",Ie,Q(b.value?"Editar Producto":"Crear Producto"),1),o(I),$(o(C,{icon:"close",flat:"",round:"",dense:"",onClick:F},null,512),[[M]])]),_:1}),o(L,{class:"q-pa-lg"},{default:t(()=>[o(le,{onSubmit:ae(ne,["prevent"]),class:"form-container"},{default:t(()=>[s("div",Le,[o(v,{modelValue:u.value.code_reference,"onUpdate:modelValue":e[11]||(e[11]=a=>u.value.code_reference=a),label:"Código de Referencia",outlined:"",class:"form-field"},null,8,["modelValue"]),o(v,{modelValue:u.value.name,"onUpdate:modelValue":e[12]||(e[12]=a=>u.value.name=a),label:"Nombre",outlined:"",class:"form-field"},null,8,["modelValue"]),o(v,{modelValue:u.value.quantity,"onUpdate:modelValue":e[13]||(e[13]=a=>u.value.quantity=a),modelModifiers:{number:!0},label:"Cantidad",type:"number",outlined:"",class:"form-field"},null,8,["modelValue"]),o(v,{modelValue:u.value.price,"onUpdate:modelValue":e[14]||(e[14]=a=>u.value.price=a),modelModifiers:{number:!0},label:"Precio",type:"number",outlined:"",class:"form-field"},null,8,["modelValue"]),o(v,{modelValue:u.value.tax_rate,"onUpdate:modelValue":e[15]||(e[15]=a=>u.value.tax_rate=a),modelModifiers:{number:!0},label:"Tasa de Impuesto",type:"number",outlined:"",class:"form-field"},null,8,["modelValue"]),o(v,{modelValue:u.value.discount_rate,"onUpdate:modelValue":e[16]||(e[16]=a=>u.value.discount_rate=a),modelModifiers:{number:!0},label:"Tasa de Descuento",type:"number",outlined:"",class:"form-field"},null,8,["modelValue"])]),s("div",$e,[$((R(),te(C,{type:"button",color:"grey",class:"q-mr-md",onClick:F},{default:t(()=>e[29]||(e[29]=[w(" Cancelar ")])),_:1})),[[M]]),o(C,{type:"submit",color:"green"},{default:t(()=>[w(Q(b.value?"Actualizar Producto":"Guardar Producto"),1)]),_:1})])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]))}},We=Pe(Me,[["__scopeId","data-v-dd6200aa"]]);export{We as default};
