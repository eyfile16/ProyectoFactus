import{g as G,h,i as q,Z as s,r as u,l as R,c as L,b as t,V as o,X as c,W as b,T as l,o as j,$ as k,w as W,f as X}from"./index-ConCm_F-.js";import{u as Z,f as H,g as J,Q as K,a as Y,b as N,c as P}from"./QTable-BUWrZeTf.js";import{Q as U,a as ee}from"./QForm-h3V9JM0e.js";import{Q as ae,a as M}from"./QCard-BirL4X1V.js";import{Q as v}from"./QInput-Cz8fbQWQ.js";import{Q as oe}from"./QSpace-CItrBRwI.js";import{a as x,Q as te,C as le}from"./axios2-DnkUwo0C.js";import{u as ie}from"./use-quasar-CWqgSqmt.js";import{i as S}from"./axios-R6vW24p9.js";import"./format-MEHmbXNd.js";import"./use-dark-Df08ketR.js";import"./index-DW_MHI2K.js";const ne=G({name:"QToggle",props:{...Z,icon:String,iconColor:String},emits:H,setup(f){function r(m,p){const d=h(()=>(m.value===!0?f.checkedIcon:p.value===!0?f.indeterminateIcon:f.uncheckedIcon)||f.icon),_=h(()=>m.value===!0?f.iconColor:null);return()=>[q("div",{class:"q-toggle__track"}),q("div",{class:"q-toggle__thumb absolute flex flex-center no-wrap"},d.value!==void 0?[q(s,{name:d.value,color:_.value})]:void 0)]}return J("toggle",r)}}),re={class:"products-container"},se={class:"content-card fade-in"},de={class:"header-section"},ue={class:"flex justify-between items-center"},ce={class:"header-title"},me={class:"full-width row flex-center q-pa-md text-grey-8"},pe={class:"text-center"},ve={class:"flex justify-center space-x-2"},fe={class:"text-h4"},_e={class:"form-container"},be={class:"form-section"},ge={class:"section-title"},ye={class:"form-grid"},xe={class:"form-field"},Ve={class:"form-field col-span-2"},Ce={class:"form-field"},we={class:"form-section"},qe={class:"section-title"},Pe={class:"form-grid"},Ee={class:"form-field"},Qe={class:"form-field"},Ie={class:"form-field"},he={class:"form-field"},ke={class:"form-section"},Ne={class:"section-title"},Ue={class:"form-grid"},Me={class:"form-field"},Se={class:"form-field"},ze={class:"form-field"},Ae={class:"form-field col-span-2"},Ze={__name:"ProductsManagement",setup(f){const r=ie(),m=u([]),p=u(!1),d=u(!1),_=u(null),g=u(!0),V=u([]),z=u([{id:1,name:"Estándar de adopción del contribuyente",value:1,label:"Estándar de adopción del contribuyente"},{id:2,name:"UNSPSC",value:2,label:"UNSPSC"},{id:3,name:"Partida Arancelaria",value:3,label:"Partida Arancelaria"},{id:4,name:"GTIN",value:4,label:"GTIN"}]),C=u([]),y=u({sortBy:"name",descending:!1,page:1,rowsPerPage:10,rowsNumber:0}),i=u({scheme_id:"0",code_reference:"",name:"",quantity:1,discount_rate:0,price:0,tax_rate:"5.00",unit_measure_id:70,standard_code_id:1,is_excluded:0,tribute_id:"1",withholding_taxes:[]}),A=[{name:"code_reference",required:!0,label:"Código",align:"left",field:"code_reference",sortable:!0},{name:"name",required:!0,label:"Nombre",align:"left",field:"name",sortable:!0},{name:"price",label:"Precio",field:"price",sortable:!0},{name:"quantity",label:"Cantidad",field:"quantity",sortable:!0},{name:"tax_rate",label:"Impuesto (%)",field:"tax_rate",sortable:!0},{name:"actions",label:"Acciones",field:"actions",align:"center"}];function T(n){return new Intl.NumberFormat("es-CO",{style:"currency",currency:"COP",minimumFractionDigits:0}).format(n)}R(async()=>{g.value=!0;try{await Promise.all([w(),$()])}catch(n){console.error("Error loading initial data:",n),r&&r.notify({type:"negative",message:"Error cargando datos iniciales",position:"top"})}finally{g.value=!1}});async function w(){try{const n=await x.get("/productos/");m.value=Array.isArray(n.data)?n.data:[],y.value.rowsNumber=m.value.length}catch(n){console.error("Error fetching products:",n),r&&r.notify({type:"negative",message:"Error cargando productos",position:"top"}),m.value=[],y.value.rowsNumber=0}}async function E(){var n,a;try{const e={...i.value,is_excluded:i.value.is_excluded?1:0};d.value?(await x.put(`/productos/${_.value}`,e),r&&r.notify({type:"positive",message:"Producto actualizado correctamente",position:"top"})):(await x.post("/productos/",e),r&&r.notify({type:"positive",message:"Producto creado correctamente",position:"top"})),await w(),Q()}catch(e){console.error("Error al guardar producto:",e),r&&r.notify({type:"negative",message:((a=(n=e.response)==null?void 0:n.data)==null?void 0:a.message)||"Error al guardar el producto",position:"top"})}}async function D(n){try{await x.delete(`/productos/${n}`),await w(),r&&r.notify({type:"positive",message:"Producto eliminado correctamente",position:"top"})}catch(a){console.error("Error al eliminar producto:",a),r&&r.notify({type:"negative",message:"No se pudo eliminar el producto",position:"top"})}}function B(n){i.value={...n},p.value=!0,d.value=!0,_.value=n.id}function Q(){p.value=!1,I()}function I(){i.value={scheme_id:"0",code_reference:"",name:"",quantity:1,discount_rate:0,price:0,tax_rate:"5.00",unit_measure_id:70,standard_code_id:1,is_excluded:0,tribute_id:"1",withholding_taxes:[]},d.value=!1,_.value=null}function O(){I(),p.value=!0,d.value=!1}async function $(){try{const n=await S.get("/v1/unit-measures");n&&n.data&&n.data.data&&(V.value=n.data.data.map(e=>({id:e.id,name:e.name,value:e.id,label:e.name})));const a=await S.get("/v1/tributes");a&&a.data&&a.data.data&&(C.value=a.data.data.map(e=>({id:e.id,name:e.name,value:e.id,label:e.name})))}catch(n){console.error("Error loading reference data:",n),r&&r.notify({type:"negative",message:"Error cargando datos de referencia",position:"top"}),V.value=[{id:70,name:"unidad",value:70,label:"unidad"},{id:71,name:"kilogramo",value:71,label:"kilogramo"},{id:72,name:"libra",value:72,label:"libra"},{id:73,name:"metro",value:73,label:"metro"},{id:74,name:"galón",value:74,label:"galón"}],C.value=[{id:"1",name:"IVA",value:"1",label:"IVA"},{id:"4",name:"INC",value:"4",label:"Impuesto Nacional al Consumo"}]}}return(n,a)=>(j(),L("div",re,[t("div",se,[t("div",de,[t("div",ue,[t("h2",ce,[o(s,{name:"inventory_2",size:"2rem",class:"q-mr-sm"}),a[13]||(a[13]=c(" Gestión de Productos "))]),o(b,{color:"white","text-color":"primary",label:"Crear Nuevo Producto",onClick:O,class:"action-button",disable:g.value,icon:"add_box"},null,8,["disable"])])]),o(K,{rows:m.value,columns:A,"row-key":"id",loading:g.value,class:"products-table",pagination:y.value,"onUpdate:pagination":a[0]||(a[0]=e=>y.value=e),"rows-per-page-options":[10,20,50],"binary-state-sort":""},{loading:l(()=>a[14]||(a[14]=[t("div",{class:"loading-overlay"},[t("div",{class:"loading-spinner"})],-1)])),"no-data":l(()=>[t("div",me,[t("div",pe,[o(s,{name:"inventory",size:"4rem",color:"grey-4"}),a[15]||(a[15]=t("p",{class:"text-h6 text-grey-8 q-mt-md"},"No hay productos registrados",-1)),a[16]||(a[16]=t("p",{class:"text-grey-6"},"Comienza creando un nuevo producto",-1))])])]),"body-cell-price":l(e=>[o(N,{props:e},{default:l(()=>[c(k(T(e.value)),1)]),_:2},1032,["props"])]),"body-cell-actions":l(e=>[o(N,{props:e,class:"text-center"},{default:l(()=>[t("div",ve,[o(b,{icon:"edit",flat:"",dense:"",color:"primary",onClick:F=>B(e.row),class:"action-button"},{default:l(()=>[o(U,null,{default:l(()=>a[17]||(a[17]=[c("Editar producto")])),_:1})]),_:2},1032,["onClick"]),o(b,{icon:"delete",flat:"",dense:"",color:"negative",onClick:F=>D(e.row.id),class:"action-button"},{default:l(()=>[o(U,null,{default:l(()=>a[18]||(a[18]=[c("Eliminar producto")])),_:1})]),_:2},1032,["onClick"])])]),_:2},1032,["props"])]),_:1},8,["rows","loading","pagination"])]),o(Y,{modelValue:p.value,"onUpdate:modelValue":a[12]||(a[12]=e=>p.value=e),persistent:"",maximized:""},{default:l(()=>[o(ae,{class:"modal-product"},{default:l(()=>[o(M,{class:"modal-header"},{default:l(()=>[t("div",fe,[o(s,{name:d.value?"edit":"add_box",size:"lg"},null,8,["name"]),c(" "+k(d.value?"Editar":"Crear")+" Producto ",1)])]),_:1}),o(M,{class:"modal-body"},{default:l(()=>[t("div",_e,[o(ee,{onSubmit:W(E,["prevent"]),class:"product-form"},{default:l(()=>[t("div",be,[t("div",ge,[o(s,{name:"info",size:"md"}),a[19]||(a[19]=c(" Información Básica del Producto "))]),t("div",ye,[t("div",xe,[o(v,{modelValue:i.value.code_reference,"onUpdate:modelValue":a[1]||(a[1]=e=>i.value.code_reference=e),label:"Código de Referencia",outlined:"",required:"",dense:"",rules:[e=>!!e||"El código es requerido"]},{prepend:l(()=>[o(s,{name:"qr_code"})]),_:1},8,["modelValue","rules"])]),t("div",Ve,[o(v,{modelValue:i.value.name,"onUpdate:modelValue":a[2]||(a[2]=e=>i.value.name=e),label:"Nombre del Producto",outlined:"",required:"",dense:"",rules:[e=>!!e||"El nombre es requerido"]},{prepend:l(()=>[o(s,{name:"inventory"})]),_:1},8,["modelValue","rules"])]),t("div",Ce,[o(P,{modelValue:i.value.standard_code_id,"onUpdate:modelValue":a[3]||(a[3]=e=>i.value.standard_code_id=e),options:z.value,"option-value":"id","option-label":"name",label:"Código Estándar",outlined:"",dense:"","emit-value":"","map-options":"",required:"",rules:[e=>!!e||"El código estándar es requerido"]},{prepend:l(()=>[o(s,{name:"qr_code_2"})]),_:1},8,["modelValue","options","rules"])])])]),t("div",we,[t("div",qe,[o(s,{name:"payments",size:"md"}),a[20]||(a[20]=c(" Información de Precios y Cantidades "))]),t("div",Pe,[t("div",Ee,[o(v,{modelValue:i.value.quantity,"onUpdate:modelValue":a[4]||(a[4]=e=>i.value.quantity=e),modelModifiers:{number:!0},type:"number",label:"Cantidad",outlined:"",required:"",dense:"",rules:[e=>e>0||"La cantidad debe ser mayor a 0"]},{prepend:l(()=>[o(s,{name:"inventory_2"})]),_:1},8,["modelValue","rules"])]),t("div",Qe,[o(v,{modelValue:i.value.price,"onUpdate:modelValue":a[5]||(a[5]=e=>i.value.price=e),modelModifiers:{number:!0},type:"number",label:"Precio Unitario",outlined:"",required:"",dense:"",rules:[e=>e>0||"El precio debe ser mayor a 0"]},{prepend:l(()=>[o(s,{name:"attach_money"})]),append:l(()=>a[21]||(a[21]=[t("div",{class:"text-grey-7"},"COP",-1)])),_:1},8,["modelValue","rules"])]),t("div",Ie,[o(v,{modelValue:i.value.discount_rate,"onUpdate:modelValue":a[6]||(a[6]=e=>i.value.discount_rate=e),modelModifiers:{number:!0},type:"number",label:"Descuento",outlined:"",dense:"",min:"0",max:"100"},{prepend:l(()=>[o(s,{name:"local_offer"})]),append:l(()=>a[22]||(a[22]=[t("div",{class:"text-grey-7"},"%",-1)])),_:1},8,["modelValue"])]),t("div",he,[o(ne,{modelValue:i.value.is_excluded,"onUpdate:modelValue":a[7]||(a[7]=e=>i.value.is_excluded=e),label:"Excluido de impuestos",color:"primary","left-label":"",dense:""},null,8,["modelValue"])])])]),t("div",ke,[t("div",Ne,[o(s,{name:"receipt_long",size:"md"}),a[23]||(a[23]=c(" Información Fiscal y Medidas "))]),t("div",Ue,[t("div",Me,[o(v,{modelValue:i.value.tax_rate,"onUpdate:modelValue":a[8]||(a[8]=e=>i.value.tax_rate=e),label:"Impuesto",outlined:"",required:"",dense:"",rules:[e=>!!e||"La tasa de impuesto es requerida"]},{prepend:l(()=>[o(s,{name:"percent"})]),append:l(()=>a[24]||(a[24]=[t("div",{class:"text-grey-7"},"%",-1)])),_:1},8,["modelValue","rules"])]),t("div",Se,[o(P,{modelValue:i.value.unit_measure_id,"onUpdate:modelValue":a[9]||(a[9]=e=>i.value.unit_measure_id=e),options:V.value,"option-value":"id","option-label":"name",label:"Unidad de Medida",outlined:"",dense:"","emit-value":"","map-options":"",required:"",rules:[e=>!!e||"La unidad de medida es requerida"]},{prepend:l(()=>[o(s,{name:"straighten"})]),_:1},8,["modelValue","options","rules"])]),t("div",ze,[o(P,{modelValue:i.value.tribute_id,"onUpdate:modelValue":a[10]||(a[10]=e=>i.value.tribute_id=e),options:C.value,"option-value":"id","option-label":"name",label:"Tributo",outlined:"",dense:"","emit-value":"","map-options":"",required:"",rules:[e=>!!e||"El tributo es requerido"]},{prepend:l(()=>[o(s,{name:"account_balance"})]),_:1},8,["modelValue","options","rules"])]),t("div",Ae,[o(v,{modelValue:i.value.description,"onUpdate:modelValue":a[11]||(a[11]=e=>i.value.description=e),label:"Descripción adicional",outlined:"",dense:"",type:"textarea",autogrow:""},{prepend:l(()=>[o(s,{name:"description"})]),_:1},8,["modelValue"])])])])]),_:1})])]),_:1}),o(te,{class:"modal-footer"},{default:l(()=>[o(oe),X(o(b,{flat:"",label:"Cancelar",color:"negative",onClick:Q,icon:"close",class:"action-button",padding:"12px 20px"},null,512),[[le]]),o(b,{color:d.value?"primary":"positive",icon:d.value?"save":"add",label:d.value?"Actualizar":"Guardar",type:"submit",onClick:E,class:"action-button",padding:"12px 20px"},null,8,["color","icon","label"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]))}};export{Ze as default};
