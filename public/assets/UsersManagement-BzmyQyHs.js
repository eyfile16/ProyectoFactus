import{r as m,l as $,c as S,b as n,V as i,X as f,Z as r,W as v,T as l,o as j,$ as B,w as O,f as F}from"./index-ConCm_F-.js";import{Q as N,a as L}from"./QForm-h3V9JM0e.js";import{Q as G,a as Z,b as J,c as y}from"./QTable-BUWrZeTf.js";import{Q as W,a as I}from"./QCard-BirL4X1V.js";import{Q as c}from"./QInput-Cz8fbQWQ.js";import{m as X,n as H}from"./format-MEHmbXNd.js";import{a as E,Q as K,C as Y}from"./axios2-DnkUwo0C.js";import{u as ee}from"./use-quasar-CWqgSqmt.js";import{i as x}from"./axios-R6vW24p9.js";import"./use-dark-Df08ketR.js";import"./index-DW_MHI2K.js";const ae={class:"users-container"},ie={class:"content-card fade-in"},oe={class:"header-section"},le={class:"flex justify-between items-center"},te={class:"header-title"},ne={class:"full-width row flex-center q-pa-md text-grey-8"},se={class:"text-center"},re={class:"flex justify-center space-x-2"},de={class:"text-h6"},ue={class:"form-grid"},me={class:"form-field"},ce={class:"form-field"},pe={class:"form-field"},fe={class:"form-field"},ve={class:"form-field"},_e={class:"form-field"},ge={class:"form-field col-span-3"},be={class:"form-field"},ye={class:"form-field"},Ve={class:"form-field"},we={class:"form-field col-span-2"},Ce={class:"form-field"},ke={__name:"UsersManagement",setup(Ee){const s=ee(),_=m([]),p=m(!1),d=m(!1),V=m(null),g=m(!0),Q=[{id:"1",name:"Cédula de Ciudadanía"},{id:"2",name:"NIT"},{id:"3",name:"Cédula de Extranjería"},{id:"4",name:"Pasaporte"},{id:"5",name:"Documento de Identificación Extranjero"},{id:"6",name:"NIT de otro país"},{id:"7",name:"Tarjeta de Identidad"},{id:"8",name:"Registro Civil"},{id:"9",name:"Documento de Identificación de Menor"},{id:"10",name:"Permiso Especial de Permanencia"},{id:"11",name:"Salvoconducto"},{id:"12",name:"Documento de Identificación Provisional"},{id:"13",name:"Otro"}],z=[{id:"1",name:"Persona Natural"},{id:"2",name:"Persona Jurídica"}],D=[{id:"21",name:"IVA"},{id:"2",name:"Impuesto al Consumo"},{id:"3",name:"Impuesto Nacional al Consumo"},{id:"4",name:"Retención en la Fuente"},{id:"5",name:"Retención de IVA"},{id:"6",name:"Retención de ICA"},{id:"7",name:"Retención de Cree"},{id:"8",name:"Retención de Impuesto al Consumo"},{id:"9",name:"Retención de Impuesto Nacional al Consumo"},{id:"10",name:"Otros"}],u=m([]),b=m({sortBy:"names",descending:!1,page:1,rowsPerPage:10,rowsNumber:0}),o=m({identification:"",dv:"",company:"",trade_name:"",names:"",address:"",email:"",phone:"",legal_organization_id:"",tribute_id:"21",identification_document_id:"",municipality_id:"",status:!0}),T=[{name:"identification",required:!0,label:"Identificación",align:"left",field:"identification",sortable:!0},{name:"dv",label:"DV",field:"dv",align:"center",sortable:!0},{name:"names",required:!0,label:"Nombre",align:"left",field:"names",sortable:!0},{name:"company",label:"Empresa",field:"company",sortable:!0},{name:"email",label:"Correo",field:"email",sortable:!0},{name:"phone",label:"Teléfono",field:"phone",sortable:!0},{name:"address",label:"Dirección",field:"address",sortable:!0},{name:"actions",label:"Acciones",field:"actions",align:"center"}];$(async()=>{g.value=!0;try{await Promise.all([w(),A()])}catch(t){console.error("Error loading initial data:",t),s&&s.notify({type:"negative",message:"Error cargando datos iniciales",position:"top"})}finally{g.value=!1}});async function A(){try{const t=await x.get("/v1/municipalities");if(t.data){const a=Array.isArray(t.data)?t.data:t.data.data||[];u.value=a.map(e=>({id:e.id||e.municipality_id,name:e.name||e.municipality_name,department_id:e.department_id}))}}catch(t){console.error("Error cargando municipios:",t),s&&s.notify({type:"negative",message:"Error cargando municipios",position:"top",timeout:2500}),u.value=[]}}async function w(){try{const t=await E.get("/usuarios/");_.value=Array.isArray(t.data)?t.data:[],b.value.rowsNumber=_.value.length}catch(t){throw console.error("Error fetching users:",t),s&&s.notify({type:"negative",message:"Error cargando usuarios",position:"top"}),_.value=[],b.value.rowsNumber=0,t}}function k(t,a){if(t===""){a(()=>{u.value=u.value});return}a(()=>{const e=t.toLowerCase();u.value=u.value.filter(C=>C.name.toLowerCase().indexOf(e)>-1)})}async function U(){var t,a;try{const e={...o.value,municipality_id:Number(o.value.municipality_id),identification_document_id:Number(o.value.identification_document_id),legal_organization_id:Number(o.value.legal_organization_id),tribute_id:Number(o.value.tribute_id)};d.value?(await E.put(`/usuarios/${V.value}`,e),s&&s.notify({type:"positive",message:"Usuario actualizado correctamente",position:"top"})):(await E.post("/usuarios/",e),s&&s.notify({type:"positive",message:"Usuario creado correctamente",position:"top"})),await w(),h()}catch(e){console.error("Error al guardar usuario:",e),s&&s.notify({type:"negative",message:((a=(t=e.response)==null?void 0:t.data)==null?void 0:a.message)||"Error al guardar el usuario",position:"top"})}}async function M(t){try{await x.delete(`/v1/third-parties/${t}`),await w(),s&&s.notify({type:"positive",message:"Usuario eliminado correctamente",position:"top"})}catch(a){console.error("Error al eliminar usuario:",a),s&&s.notify({type:"negative",message:"No se pudo eliminar el usuario",position:"top"})}}function P(t){o.value={...t},p.value=!0,d.value=!0,V.value=t.id}function h(){p.value=!1,q()}function q(){o.value={identification:"",dv:"",company:"",trade_name:"",names:"",address:"",email:"",phone:"",legal_organization_id:"",tribute_id:"21",identification_document_id:"",municipality_id:"",status:!0},d.value=!1,V.value=null}function R(){q(),p.value=!0,d.value=!1}return(t,a)=>(j(),S("div",ae,[n("div",ie,[n("div",oe,[n("div",le,[n("h2",te,[i(r,{name:"people",size:"2rem",class:"q-mr-sm"}),a[14]||(a[14]=f(" Gestión de Usuarios "))]),i(v,{color:"white","text-color":"primary",label:"Crear Nuevo Usuario",onClick:R,class:"action-button",disable:g.value,icon:"person_add"},null,8,["disable"])])]),i(G,{rows:_.value,columns:T,"row-key":"id",loading:g.value,class:"users-table",pagination:b.value,"onUpdate:pagination":a[0]||(a[0]=e=>b.value=e),"rows-per-page-options":[10,20,50],"binary-state-sort":""},{loading:l(()=>a[15]||(a[15]=[n("div",{class:"loading-overlay"},[n("div",{class:"loading-spinner"})],-1)])),"no-data":l(()=>[n("div",ne,[n("div",se,[i(r,{name:"people_outline",size:"4rem",color:"grey-4"}),a[16]||(a[16]=n("p",{class:"text-h6 text-grey-8 q-mt-md"},"No hay usuarios registrados",-1)),a[17]||(a[17]=n("p",{class:"text-grey-6"},"Comienza creando un nuevo usuario",-1))])])]),"body-cell-actions":l(e=>[i(J,{props:e,class:"text-center"},{default:l(()=>[n("div",re,[i(v,{icon:"edit",flat:"",dense:"",color:"primary",onClick:C=>P(e.row),class:"action-button"},{default:l(()=>[i(N,null,{default:l(()=>a[18]||(a[18]=[f("Editar usuario")])),_:1})]),_:2},1032,["onClick"]),i(v,{icon:"delete",flat:"",dense:"",color:"negative",onClick:C=>M(e.row.id),class:"action-button"},{default:l(()=>[i(N,null,{default:l(()=>a[19]||(a[19]=[f("Eliminar usuario")])),_:1})]),_:2},1032,["onClick"])])]),_:2},1032,["props"])]),_:1},8,["rows","loading","pagination"])]),i(Z,{modelValue:p.value,"onUpdate:modelValue":a[13]||(a[13]=e=>p.value=e),persistent:""},{default:l(()=>[i(W,{class:"modal-card"},{default:l(()=>[i(I,{class:"modal-header"},{default:l(()=>[n("div",de,[i(r,{name:d.value?"edit":"person_add",class:"q-mr-sm"},null,8,["name"]),f(" "+B(d.value?"Editar":"Crear")+" Usuario ",1)])]),_:1}),i(I,{class:"modal-body"},{default:l(()=>[i(L,{onSubmit:O(U,["prevent"]),class:"user-form"},{default:l(()=>[n("div",ue,[n("div",me,[i(c,{modelValue:o.value.identification,"onUpdate:modelValue":a[1]||(a[1]=e=>o.value.identification=e),label:"Identificación",outlined:"",required:"",rules:[e=>!!e||"La identificación es requerida"],class:"full-width"},{prepend:l(()=>[i(r,{name:"badge"})]),_:1},8,["modelValue","rules"])]),n("div",ce,[i(c,{modelValue:o.value.dv,"onUpdate:modelValue":a[2]||(a[2]=e=>o.value.dv=e),label:"DV",outlined:"",class:"full-width"},{prepend:l(()=>[i(r,{name:"numbers"})]),_:1},8,["modelValue"])]),n("div",pe,[i(y,{modelValue:o.value.identification_document_id,"onUpdate:modelValue":a[3]||(a[3]=e=>o.value.identification_document_id=e),options:Q,"option-value":"id","option-label":"name",label:"Tipo de Documento",outlined:"","emit-value":"","map-options":"",rules:[e=>!!e||"El tipo de documento es requerido"],class:"full-width"},{prepend:l(()=>[i(r,{name:"article"})]),_:1},8,["modelValue","rules"])]),n("div",fe,[i(c,{modelValue:o.value.names,"onUpdate:modelValue":a[4]||(a[4]=e=>o.value.names=e),label:"Nombre",outlined:"",required:"",rules:[e=>!!e||"El nombre es requerido"],class:"full-width"},{prepend:l(()=>[i(r,{name:"person"})]),_:1},8,["modelValue","rules"])]),n("div",ve,[i(c,{modelValue:o.value.company,"onUpdate:modelValue":a[5]||(a[5]=e=>o.value.company=e),label:"Empresa",outlined:"",class:"full-width"},{prepend:l(()=>[i(r,{name:"apartment"})]),_:1},8,["modelValue"])]),n("div",_e,[i(y,{modelValue:o.value.legal_organization_id,"onUpdate:modelValue":a[6]||(a[6]=e=>o.value.legal_organization_id=e),options:z,"option-value":"id","option-label":"name",label:"Tipo de Organización",outlined:"","emit-value":"","map-options":"",rules:[e=>!!e||"El tipo de organización es requerido"],class:"full-width"},{prepend:l(()=>[i(r,{name:"business"})]),_:1},8,["modelValue","rules"])]),n("div",ge,[i(c,{modelValue:o.value.trade_name,"onUpdate:modelValue":a[7]||(a[7]=e=>o.value.trade_name=e),label:"Nombre Comercial",outlined:"",class:"full-width"},{prepend:l(()=>[i(r,{name:"store"})]),_:1},8,["modelValue"])]),n("div",be,[i(c,{modelValue:o.value.email,"onUpdate:modelValue":a[8]||(a[8]=e=>o.value.email=e),type:"email",label:"Correo",outlined:"",required:"",rules:[e=>!!e||"El correo es requerido",e=>/^[^@]+@[^@]+\.[a-zA-Z]{2,}$/.test(e)||"Correo inválido"],class:"full-width"},{prepend:l(()=>[i(r,{name:"email"})]),_:1},8,["modelValue","rules"])]),n("div",ye,[i(c,{modelValue:o.value.phone,"onUpdate:modelValue":a[9]||(a[9]=e=>o.value.phone=e),label:"Teléfono",outlined:"",required:"",rules:[e=>!!e||"El teléfono es requerido"],class:"full-width"},{prepend:l(()=>[i(r,{name:"phone"})]),_:1},8,["modelValue","rules"])]),n("div",Ve,[i(y,{modelValue:o.value.tribute_id,"onUpdate:modelValue":a[10]||(a[10]=e=>o.value.tribute_id=e),options:D,"option-value":"id","option-label":"name",label:"Tributo",outlined:"","emit-value":"","map-options":"",rules:[e=>!!e||"El tributo es requerido"],class:"full-width"},{prepend:l(()=>[i(r,{name:"receipt"})]),_:1},8,["modelValue","rules"])]),n("div",we,[i(c,{modelValue:o.value.address,"onUpdate:modelValue":a[11]||(a[11]=e=>o.value.address=e),label:"Dirección",outlined:"",required:"",rules:[e=>!!e||"La dirección es requerida"],class:"full-width"},{prepend:l(()=>[i(r,{name:"location_on"})]),_:1},8,["modelValue","rules"])]),n("div",Ce,[i(y,{modelValue:o.value.municipality_id,"onUpdate:modelValue":a[12]||(a[12]=e=>o.value.municipality_id=e),options:u.value,"option-value":"id","option-label":"name",label:"Municipio",outlined:"","use-input":"","input-debounce":"300",onFilter:k,"emit-value":"","map-options":"",loading:!u.value.length,required:"",rules:[e=>!!e||"El municipio es requerido"],class:"full-width"},{prepend:l(()=>[i(r,{name:"location_city"})]),"no-option":l(()=>[i(X,null,{default:l(()=>[i(H,{class:"text-grey"},{default:l(()=>a[20]||(a[20]=[f(" No se encontraron resultados ")])),_:1})]),_:1})]),_:1},8,["modelValue","options","loading","rules"])])])]),_:1})]),_:1}),i(K,{align:"right",class:"modal-footer"},{default:l(()=>[F(i(v,{flat:"",label:"Cancelar",color:"negative",onClick:h,icon:"close",class:"action-button"},null,512),[[Y]]),i(v,{color:d.value?"primary":"positive",icon:d.value?"save":"add",label:d.value?"Actualizar":"Guardar",type:"submit",onClick:U,class:"action-button"},null,8,["color","icon","label"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]))}};export{ke as default};
